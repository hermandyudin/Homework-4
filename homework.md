# Homework 4
## Task 1. ADR

ADR 1: Исправляем ошибки из-за сервиса бонусов при правильном выполнении задания кандидатом.


Status. Proposed.


Context. 
На момент принятия решения бизнес планировал отправлять запрос на начисление баллов сразу при правильном выполнении задания кандидатом, с помощью синхронного запроса в сервис бонусов. Вот так выглядит этот процесс со стороны бизнес-процесса:
![Текущий запрос для начисления баллов при правильном выполнении задания](images/current_request.png)


Как выглядит процесс открытия домашки со стороны бизнес-процесса. 
Как выглядит процесс открытия домашки со стороны бизнес-процесса. Посмотреть поближе
При этом, чтобы бизнес-логика работала, необходимы ещё два набора сущностей, которые были определены в system form: студенты и домашка под урок. Обе сущности уже заранее передаются в сервис с домашками с помощью асинхронной event-driven-коммуникации.
Два набора сущностей, которые необходимы в сервисе домашек и передаются из других частей системы. 
Два набора сущностей, которые необходимы в сервисе домашек и передаются из других частей системы. Посмотреть поближе
На момент принятия решения в момент, когда ученик отмечал урок прочитанным, сервис предоставления уроков отправлял асинхронное событие ChangeLessonStatus. К сожалению, у бизнеса возникли проблемы с такой реализацией коммуникации, которые выглядели так:
Данные обновляются с задержкой. Студенты делают домашку сразу после урока, но преподаватели видят её только через несколько минут или часов.
   
Данная проблема возникала из-за eventual consistency, который возник из-за использования асинхронной коммуникации. Чтобы решить проблему, нужно добиться strong consistency в этом месте.
Decision.
Единственный способ решить проблему перехода с eventual consistency на strong consistency — перевести связь с асинхронной на синхронную. Так как синхронная связь может быть только request-response, то остаётся выбрать способ имплементации в коде.
В нашем проекте не используется RPC для коммуникации между сервисами, по дефолту — http-вызовы. Следовательно, асинхронное событие ChangeLessonStatus будет заменено на синхронный http-вызов.
